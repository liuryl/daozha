#include "MQTT.h"
#include "Uart.h"
#include "delay.h"
#include <REGX51.H>


code char MQTT_Connect[]={ 
0x10,0x7e,0x00,0x04,0x4d,0x51,0x54,0x54,0x04,0xc2,
0x00,0x3c,0x00,0x33,0x2e,0x2e,0x2e,0x7c,0x73,0x65,
0x63,0x75,0x72,0x65,0x6d,0x6f,0x64,0x65,0x3d,0x33,
0x2c,0x73,0x69,0x67,0x6e,0x6d,0x65,0x74,0x68,0x6f,
0x64,0x3d,0x68,0x6d,0x61,0x63,0x73,0x68,0x61,0x31,
0x2c,0x74,0x69,0x6d,0x65,0x73,0x74,0x61,0x6d,0x70,
0x3d,0x37,0x38,0x39,0x7c,0x00,0x13,0x64,0x61,0x6f,
0x7a,0x68,0x61,0x31,0x26,0x67,0x65,0x79,0x6c,0x55,
0x6b,0x7a,0x52,0x63,0x49,0x51,0x00,0x28,0x66,0x62,
0x32,0x61,0x35,0x36,0x32,0x61,0x30,0x35,0x62,0x65,
0x63,0x64,0x66,0x36,0x34,0x33,0x33,0x38,0x33,0x39,
0x32,0x64,0x36,0x39,0x33,0x30,0x39,0x38,0x39,0x66,
0x34,0x33,0x65,0x30,0x34,0x39,0x30,0x33,
};
//属性上报的报文：off人
code  char MQTT_Post_Property_off[]={ 
0x30,0x9b,0x01,0x00,0x32,0x2f,0x73,0x79,0x73,0x2f,
0x67,0x65,0x79,0x6c,0x55,0x6b,0x7a,0x52,0x63,0x49,
0x51,0x2f,0x64,0x61,0x6f,0x7a,0x68,0x61,0x31,0x2f,
0x74,0x68,0x69,0x6e,0x67,0x2f,0x65,0x76,0x65,0x6e,
0x74,0x2f,0x70,0x72,0x6f,0x70,0x65,0x72,0x74,0x79,
0x2f,0x70,0x6f,0x73,0x74,0x7b,0x22,0x69,0x64,0x22,
0x3a,0x22,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,
0x39,0x22,0x2c,0x22,0x76,0x65,0x72,0x73,0x69,0x6f,
0x6e,0x22,0x3a,0x22,0x31,0x2e,0x30,0x22,0x2c,0x22,
0x70,0x61,0x72,0x61,0x6d,0x73,0x22,0x3a,0x7b,0x22,
0x4d,0x6f,0x74,0x69,0x6f,0x6e,0x41,0x6c,0x61,0x72,
0x6d,0x53,0x74,0x61,0x74,0x65,0x22,0x3a,0x31,0x7d,
0x2c,0x22,0x6d,0x65,0x74,0x68,0x6f,0x64,0x22,0x3a,
0x22,0x74,0x68,0x69,0x6e,0x67,0x2e,0x65,0x76,0x65,
0x6e,0x74,0x2e,0x70,0x72,0x6f,0x70,0x65,0x72,0x74,
0x79,0x2e,0x70,0x6f,0x73,0x74,0x22,0x7d,};


code unsigned char MQTT_Heart[]={0xc0,0x00}; 

char Init_MQTT(void){
			
	do{
		count = 0;
		Send_Str(MQTT_Connect,128);
		while(!count);
		DelayMs(50);		
	}while(count != 4 || buffers[0] != 0x20 );
	if(buffers[3] == 0x00){
		return 2;
	}
	return 0;
	
}

void MQTT_Publish_off(void){

		Send_Str(MQTT_Post_Property_off,158);
		//while(!count);
		DelayMs(50);	
}

void MQTT_Heart_send(void){
		Send_Str(MQTT_Heart,2);
		//while(!count);
		DelayMs(50);
}

